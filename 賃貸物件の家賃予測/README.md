# 不動産賃料予測プロジェクト

## 大会概要
このプロジェクトでは、[マイナビ × SIGNATE Student Cup 2019: 賃貸物件の家賃予測](https://signate.jp/competitions/264)に基づき、東京都内の不動産賃料を予測するモデルを構築します。物件の特徴（間取り、築年数、立地など）から賃料を予測することで、不動産市場の価格形成要因を分析します。

## データセット
### コンペで提供されたデータセット
- `train.csv`: 訓練用データセット（物件情報と賃料）
- `test.csv`: テスト用データセット（物件情報のみ）
- `sample_submit.csv`: 提出フォーマット
### 追加したデータセット
- `geoencoded_districts.csv`: 地理情報データ（緯度・経度）
- `Jika_2019.csv`: 2019年の地価公示データ

## 特徴量

### 基本情報
- `賃料`（Target）: 物件の月額賃料
- `所在地`（Location）: 物件の住所
- `アクセス`（Access）: 最寄り駅までの距離情報
- `間取り`（Floor_Plan）: 部屋の間取り情報
- `築年数`（Age_of_Building）: 建物の築年数
- `方角`（Direction）: 物件の向き
- `面積`（Area）: 物件の面積（m²）
- `所在階`（Story_and_Floor）: 建物の階数と物件の所在階

### 設備情報
- `バス・トイレ`（Bath_and_Toilet）: 浴室・トイレの設備情報
- `キッチン`（Kitchen）: キッチンの種類と設備
- `放送・通信`（Broadcasting_and_Communication）: 通信環境
- `室内設備`（Indoor_Facilities）: 室内の設備情報
- `駐車場`（Parking）: 駐車場の有無と状況
- `周辺環境`（Surrounding_Environment）: 近隣施設の情報
- `建物構造`（Architecture）: 建物の構造
- `契約期間`（Contract_Period）: 賃貸契約の期間情報

## 前処理の詳細

### 地理情報の処理
- 区名の抽出とエンコード
- 都心5区（千代田区、中央区、港区、渋谷区、新宿区）かどうかのフラグ作成
- 緯度経度情報の追加
- 地価情報の追加
- 港区・中央区からの距離ポテンシャル計算

### アクセス情報の処理
- 路線名の統一と標準化
- 最寄り駅への徒歩時間抽出
- 駅近評価指標の作成（5分以内:2、10分以内:1、それ以外:0）
- 利用可能な路線数のカウント

### 間取り情報の処理
- 居室数の抽出
- リビング、ダイニング、キッチン、物置の有無の判定
- ワンルームかどうかの判定
- 部屋の総数の計算

### 築年数の処理
- 築年数の月数への変換
- 新築フラグの作成
- 築年数のランク付け（10年未満:2、20年未満:1、それ以上:0）

### 面積情報の処理
- 面積の数値部分の抽出
- 単位面積あたりの賃料計算

### 階数情報の処理
- 建物の最大階数と物件の所在階の抽出
- 地下階の有無の判定
- 階数比率の計算

### 設備情報の処理
- バス・トイレ設備の機能数カウント
- インターネット環境の判定
- キッチン設備のランク付け
- 室内設備の種類と数のカウント
- 駐車場の状況判定（車、自転車、バイク）

### 周辺環境の処理
- 最寄りのスーパー・コンビニまでの距離抽出
- 周辺施設数のカウント

### 建物構造の処理
- 建物素材によるランク付け（SRC > RC > HPC > ... > 木造）

### その他の処理
- 異常値や外れ値の削除
- 欠損値の補完
- カテゴリ変数の処理

## モデルアーキテクチャ

価格帯によって2つの別々のモデルを構築：

1. 一般価格帯モデル（30万円以下の物件）
   - 5分割交差検証
   - 単位面積あたりの賃料を予測
   - LGBM（Light Gradient Boosting Machine）を使用

2. 高価格帯モデル（10万円以上の物件）
   - 5分割交差検証
   - 単位面積あたりの賃料を予測
   - LGBM（Light Gradient Boosting Machine）を使用

※両モデルにはオーバーラップがあり（10〜30万円の物件は両方のモデルで学習）

## LightGBMのハイパーパラメータ
```python
params = {
    'objective': 'regression',        # 回帰問題
    'metric': 'rmse',                 # 評価指標：二乗平均平方根誤差
    'boosting_type': 'gbdt',          # 勾配ブースティング決定木
    'learning_rate': 0.05,            # 学習率
    'num_leaves': 31,                 # 一つの木における最大葉の数
    'max_depth': -1,                  # 最大深さ（無制限）
    'min_child_samples': 20,          # 各葉に必要な最小サンプル数
    'max_bin': 512,                   # ヒストグラムのビン数
    'subsample': 0.85,                # サンプリング率
    'subsample_freq': 10,             # サブサンプリングの頻度
    'colsample_bytree': 0.8,          # 各木の構築に使用する特徴量の割合
    'min_child_weight': 0.001,        # 葉ノードのサンプル重みの最小合計値
    'subsample_for_bin': 200000,      # ビン計算用のサブサンプリングサイズ
    'min_split_gain': 0,              # 分割に必要な最小ゲイン
    'reg_alpha': 0,                   # L1正則化項
    'reg_lambda': 0,                  # L2正則化項
    'force_row_wise': True,           # 行単位の計算を明示的に設定
}
```

## 重要な特徴量分析
SHAPを使用して特徴量の重要度を分析し、価格に最も影響を与える要因を特定しています。

### 一般価格帯モデルの主要特徴量
- 面積
- 土地価格
- 最寄り駅までの時間
- 建物の築年数

### 高価格帯モデルの主要特徴量
- 面積
- 港区・中央区からの距離ポテンシャル
- 土地価格
- 都心5区フラグ

## ファイル構成
- `dataset/`: データファイル
- `preprocessingsV2.py`: 前処理関数
- `main.ipynb`: メインの実行コード

## 使用したライブラリ
- **Polars**: 高速なデータフレーム処理
- **Pandas**: データ分析と操作
- **NumPy**: 数値計算
- **Matplotlib**: データ可視化
- **LightGBM**: 勾配ブースティングモデル
- **scikit-learn**: 機械学習ツール
- **SHAP**: モデル解釈
- **Plotly**: インタラクティブな可視化

## 参考資料とリンク
- [SIGNATE StudentCup 2019 1位ソリューション](https://github.com/analokmaus/signate-studentcup2019/)
- [国土交通省 国土数値情報](https://nlftp.mlit.go.jp/)
- [東京都財務局 地価公示](https://www.zaimu.metro.tokyo.lg.jp/kijunchi/chikakouji/31kouji)

## 今後の改善点
- 他の機械学習アルゴリズムとのアンサンブル
- より詳細な地理情報の活用（駅からの距離だけでなく、特定の施設への近さなど）
- ニューラルネットワークモデルの検討